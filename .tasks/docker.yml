---
version: "3"

vars:
  CONTAINER_NAME: base-layer-site
  HOST_PORT: 80
  IMAGE_NAME: base-layer
  DOCKERFILE: .containers/prod/Dockerfile
  CONTEXT_PATH: ./svelte-page

tasks:
  build:
    desc: Build Docker image
    cmds:
      - docker build -f {{.DOCKERFILE}} -t {{.IMAGE_NAME}} {{.CONTEXT_PATH}}

  run:
    desc: Run container
    cmds:
      - docker run -d -p {{.HOST_PORT}}:80 --name {{.CONTAINER_NAME}} {{.IMAGE_NAME}}

  stop:
    desc: Stop and remove container
    cmds:
      - docker stop {{.CONTAINER_NAME}} || true
      - docker rm {{.CONTAINER_NAME}} || true

  restart:
    desc: Stop + start container
    deps: [stop, build:prod, run]
    run: once

  logs:
    desc: Show container logs
    cmds:
      - docker logs -f {{.CONTAINER_NAME}}

  clean:
    desc: Remove container + image
    cmds:
      - docker stop {{.CONTAINER_NAME}} || true
      - docker rm {{.CONTAINER_NAME}} || true
      - docker rmi {{.IMAGE_NAME}} || true
